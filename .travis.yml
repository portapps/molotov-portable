os: windows
language: shell

env:
  global:
    - GOVERSION: 1.11.5
    - NODEJS_VERSION: 11.9.0

before_install:
  - git clone https://github.com/portapps/portapps ${TRAVIS_BUILD_DIR}/../portapps
  - source ${TRAVIS_BUILD_DIR}/../portapps/.travis/prepare.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/java.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/ant.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/nodejs.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/go.sh
  - set

script:
  - ant release

after_success:
  - export APP_VERSION=$(cat $TRAVIS_BUILD_DIR/bin/tmp/version.dat)
  - echo ${APP_VERSION}

before_deploy:
  - git config --local user.email "builds@travis-ci.com"
  - git config --local user.name "Travis CI"
  - export TRAVIS_TAG="${APP_VERSION}"
  - git tag $TRAVIS_TAG
  - ls -al bin/release

deploy:
  provider: releases
  api_key:
    secure: F9TG2qYxvwxhEkB90gny3Y4cQ9ukQJhbfuKXP1/jBSynDdd0Iu2rn5zoX5K+WmTelRW10F16Cp/yXU8SSOcnyJLK3yejOkr2M6ngJfbGgQSi75JwLN32WY/W1D7cHKkhJWyjhnPNtBwh/JOcQq5BIUfZ4W/68OlxKZX7VYStt519ftkgxssS8Asv0imyhbxV5QTOfu+AjhYlgGyG9vXcvIjwzTntI+hfaDhGJPQ1a2xMvrUT7QMJUSVm3GEm73UlN1wIGyxfLGbz09JzDqXyKk7uGEj4c6ANWlVYcIyLTbQjtGv/1XSjaz+3E/sIacmkEJQt45/edLePl8/TBuOCSlAOVte698oAXqqNithpMAYUNJ+w5905bZ65wq9ZUoVd6Fxdsk+Ii1/jAW6QaMh/cpCriswaC4Us+eaLfN2rql8osQ5RX1aL6KmyV4WW5PhF35fbB6mrmU4CtMmXZ3fkRC1MX2JirUyshwF0jDKIxZXtpZ4VqXofEktrHUJLpJ72f48lu08gPbuNvgY/zPwQnnmTG4m+geZp+e0LLkPm48oi3fqj4TyD8IjZti3hn8WEhM5pr+bfsAG0x5FlNsX14bFMTRikR47/igseJA/c7c2dCOSGtjsKLaTdfgsdNaL7DTWyXv2yH6b4C7y25dLjbf68H8UYCLLtejWLqugmX2g=
  file_glob: true
  file: bin/release/*
  skip_cleanup: true
  draft: true
  on:
    tags: false
